<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BankMind - å®¢æˆ·ç»è¥å¯è§†åŒ–å¤§å±</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 2px solid #3498db;
        }
        
        .header h1 {
            font-size: 28px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 3px;
        }
        
        .header p {
            color: #a0a0a0;
            margin-top: 5px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* æŒ‡æ ‡å¡ç‰‡ */
        .indicators {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .indicator-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .indicator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
        }
        
        .indicator-value {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .indicator-label {
            font-size: 14px;
            color: #a0a0a0;
        }
        
        /* å›¾è¡¨åŒºåŸŸ */
        .charts-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .chart-title {
            font-size: 16px;
            color: #fff;
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 3px solid #3498db;
        }
        
        .chart {
            height: 280px;
        }
        
        .charts-row-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .chart-large {
            height: 350px;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #a0a0a0;
        }
        
        @media (max-width: 1200px) {
            .indicators {
                grid-template-columns: repeat(3, 1fr);
            }
            .charts-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .indicators {
                grid-template-columns: repeat(2, 1fr);
            }
            .charts-row, .charts-row-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¦ BankMind å®¢æˆ·ç»è¥å¯è§†åŒ–å¤§å±</h1>
        <p>å®æ—¶æ´å¯Ÿå®¢æˆ·å…¨è²Œï¼Œé©±åŠ¨ç²¾å‡†è¥é”€å†³ç­–</p>
    </div>
    
    <div class="container">
        <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
        <div class="indicators">
            <div class="indicator-card">
                <div class="indicator-value" id="total-customers">--</div>
                <div class="indicator-label">å®¢æˆ·æ€»æ•°</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-value" id="total-assets">--</div>
                <div class="indicator-label">èµ„äº§æ€»è§„æ¨¡</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-value" id="avg-assets">--</div>
                <div class="indicator-label">äººå‡èµ„äº§</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-value" id="active-customers">--</div>
                <div class="indicator-label">æ´»è·ƒå®¢æˆ·æ•°</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-value" id="repurchase-rate">--</div>
                <div class="indicator-label">å¤è´­ç‡</div>
            </div>
        </div>
        
        <!-- ç¬¬ä¸€è¡Œå›¾è¡¨ -->
        <div class="charts-row">
            <div class="chart-card">
                <div class="chart-title">ğŸ“Š å®¢æˆ·ç­‰çº§åˆ†å¸ƒ</div>
                <div id="chart-lifecycle" class="chart"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">ğŸ’° èµ„äº§ç­‰çº§åˆ†å¸ƒ</div>
                <div id="chart-asset-level" class="chart"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">ğŸ“¦ äº§å“æŒæœ‰æƒ…å†µ</div>
                <div id="chart-products" class="chart"></div>
            </div>
        </div>
        
        <!-- ç¬¬äºŒè¡Œå›¾è¡¨ -->
        <div class="charts-row-2">
            <div class="chart-card">
                <div class="chart-title">ğŸ‘¥ å¹´é¾„åˆ†å¸ƒ</div>
                <div id="chart-age" class="chart-large"></div>
            </div>
            <div class="chart-card">
                <div class="chart-title">âš ï¸ é£é™©ç­‰çº§åˆ†å¸ƒ</div>
                <div id="chart-risk" class="chart-large"></div>
            </div>
        </div>
    </div>
    
    <script>
        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 100000000) {
                return (num / 100000000).toFixed(2) + 'äº¿';
            } else if (num >= 10000) {
                return (num / 10000).toFixed(2) + 'ä¸‡';
            }
            return num.toLocaleString();
        }
        
        // æ ¼å¼åŒ–ç™¾åˆ†æ¯”
        function formatPercent(num) {
            return (num * 100).toFixed(1) + '%';
        }
        
        // åŠ è½½æŒ‡æ ‡æ•°æ®
        async function loadIndicators() {
            try {
                const response = await fetch('/api/indicators');
                const data = await response.json();
                
                document.getElementById('total-customers').textContent = formatNumber(data.total_customers);
                document.getElementById('total-assets').textContent = formatNumber(data.total_assets);
                document.getElementById('avg-assets').textContent = formatNumber(data.avg_assets);
                document.getElementById('active-customers').textContent = data.active_customers ? formatNumber(data.active_customers) : '--';
                document.getElementById('repurchase-rate').textContent = data.repurchase_rate ? formatPercent(data.repurchase_rate) : '--';
            } catch (error) {
                console.error('åŠ è½½æŒ‡æ ‡å¤±è´¥:', error);
            }
        }
        
        // åˆ›å»ºé¥¼å›¾
        function createPieChart(elementId, data, title) {
            const chart = echarts.init(document.getElementById(elementId));
            const chartData = Object.entries(data).map(([name, value]) => ({ name, value }));
            
            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: { color: '#a0a0a0' }
                },
                series: [{
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['40%', '50%'],
                    avoidLabelOverlap: false,
                    itemStyle: {
                        borderRadius: 10,
                        borderColor: '#1a1a2e',
                        borderWidth: 2
                    },
                    label: {
                        show: false
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 14,
                            fontWeight: 'bold'
                        }
                    },
                    data: chartData
                }],
                color: ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c']
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
        
        // åˆ›å»ºæŸ±çŠ¶å›¾
        function createBarChart(elementId, data, title) {
            const chart = echarts.init(document.getElementById(elementId));
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: labels,
                    axisLabel: {
                        color: '#a0a0a0',
                        rotate: 30
                    },
                    axisLine: { lineStyle: { color: '#444' } }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: { color: '#a0a0a0' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [{
                    type: 'bar',
                    data: values,
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#3498db' },
                            { offset: 1, color: '#2ecc71' }
                        ]),
                        borderRadius: [5, 5, 0, 0]
                    }
                }]
            };
            
            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }
        
        // åŠ è½½å›¾è¡¨æ•°æ®
        async function loadCharts() {
            try {
                // å®¢æˆ·ç­‰çº§
                const lifecycleRes = await fetch('/api/lifecycle');
                const lifecycleData = await lifecycleRes.json();
                createPieChart('chart-lifecycle', lifecycleData);
                
                // èµ„äº§ç­‰çº§
                const assetRes = await fetch('/api/asset_level');
                const assetData = await assetRes.json();
                createPieChart('chart-asset-level', assetData);
                
                // äº§å“æŒæœ‰
                const productRes = await fetch('/api/product_holdings');
                const productData = await productRes.json();
                createBarChart('chart-products', productData);
                
                // å¹´é¾„åˆ†å¸ƒ
                const ageRes = await fetch('/api/age_distribution');
                const ageData = await ageRes.json();
                createBarChart('chart-age', ageData);
                
                // é£é™©åˆ†å¸ƒ
                const riskRes = await fetch('/api/risk');
                const riskData = await riskRes.json();
                createPieChart('chart-risk', riskData);
                
            } catch (error) {
                console.error('åŠ è½½å›¾è¡¨å¤±è´¥:', error);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadIndicators();
            loadCharts();
            
            // æ¯60ç§’åˆ·æ–°ä¸€æ¬¡
            setInterval(() => {
                loadIndicators();
                loadCharts();
            }, 60000);
        });
    </script>
</body>
</html>

